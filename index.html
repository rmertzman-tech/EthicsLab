<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethics Assembly History Lab</title>
    
    <!-- CDN Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        
        /* Simple chart styles */
        .chart-container {
            position: relative;
            height: 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        .chart-bar {
            display: inline-block;
            background: linear-gradient(to top, #3b82f6, #60a5fa);
            margin: 0 2px;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
        }
        .chart-bar:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // ========== ALL 6 SCENARIOS ==========
        const scenarios = [
            {
                id: 'ancient-athens',
                title: 'Ancient Athens',
                period: '430 BCE',
                week: 1,
                framework: 'Virtue Ethics',
                description: 'Athenian democracy during the Peloponnesian War. Can virtue ethics coordinate diverse stakeholders when cultural consensus exists?',
                learningGoal: 'Understand when virtue ethics works - requires shared cultural framework and stable social roles',
                task: { description: 'Coordinate Athenian citizens to prevent execution of Socrates', successCriteria: 'Achieve consensus without compromising individual virtue' },
                defaultI: 0.12,
                defaultEpsilon: 0.15,
                agents: [
                    { name: 'Philosophers', framework: 'Virtue Ethics', initialATCF: 0.85, beliefs: [{text: 'Wisdom is highest virtue', strength: 90}], capabilities: [{name: 'Reasoning', level: 0.9}] },
                    { name: 'Military Leaders', framework: 'Virtue Ethics', initialATCF: 0.80, beliefs: [{text: 'Courage is highest virtue', strength: 85}], capabilities: [{name: 'Leadership', level: 0.85}] },
                    { name: 'Democratic Assembly', framework: 'Virtue Ethics', initialATCF: 0.75, beliefs: [{text: 'Justice through participation', strength: 80}], capabilities: [{name: 'Governance', level: 0.75}] }
                ]
            },
            {
                id: 'enlightenment-europe',
                title: 'Enlightenment Europe',
                period: '1795',
                week: 2,
                framework: 'Deontology',
                description: 'Post-religious wars Europe. Can universal principles enable coordination across religious differences?',
                learningGoal: 'Discover how deontology enables cross-cultural coordination through universal rational principles',
                task: { description: 'Design peace treaty after religious wars', successCriteria: 'Achieve lasting peace while respecting different religions' },
                defaultI: 0.25,
                defaultEpsilon: 0.30,
                agents: [
                    { name: 'Catholic States', framework: 'Deontology', initialATCF: 0.80, beliefs: [{text: 'Divine law', strength: 85}], capabilities: [{name: 'Diplomacy', level: 0.8}] },
                    { name: 'Protestant States', framework: 'Deontology', initialATCF: 0.80, beliefs: [{text: 'Scripture authority', strength: 85}], capabilities: [{name: 'Diplomacy', level: 0.8}] },
                    { name: 'Enlightenment Philosophers', framework: 'Deontology', initialATCF: 0.85, beliefs: [{text: 'Rational moral law', strength: 90}], capabilities: [{name: 'Reasoning', level: 0.9}] }
                ]
            },
            {
                id: 'industrial-revolution',
                title: 'Industrial Revolution',
                period: '1833',
                week: 2,
                framework: 'Consequentialism',
                description: 'Factory conditions in Industrial Britain. Can consequentialist thinking enable reform across ideological divides?',
                learningGoal: 'See how measurable outcomes break ideological deadlock when suffering is visible',
                task: { description: 'Pass Factory Act to limit child labor', successCriteria: 'Reduce working hours for children under 13' },
                defaultI: 0.08,
                defaultEpsilon: 0.35,
                agents: [
                    { name: 'Factory Owners', framework: 'Consequentialism', initialATCF: 0.75, beliefs: [{text: 'Economic growth benefits all', strength: 80}], capabilities: [{name: 'Industry', level: 0.85}] },
                    { name: 'Reform Activists', framework: 'Consequentialism', initialATCF: 0.85, beliefs: [{text: 'Reduce measurable suffering', strength: 90}], capabilities: [{name: 'Advocacy', level: 0.8}] },
                    { name: 'Parliament Members', framework: 'Consequentialism', initialATCF: 0.80, beliefs: [{text: 'Balance interests', strength: 85}], capabilities: [{name: 'Legislation', level: 0.75}] }
                ]
            },
            {
                id: 'green-belt-movement',
                title: 'Green Belt Movement',
                period: '1977-2006',
                week: 3,
                framework: 'Complexity Ethics',
                description: 'Kenya environmental restoration. Can diverse groups coordinate through functional equivalence rather than shared beliefs?',
                learningGoal: 'Discover how minimal protocol + high tolerance enables unprecedented coordination across radical difference',
                task: { description: 'Plant 51 million trees across Kenya', successCriteria: 'Coordinate traditional women, scientists, feminists, religious leaders' },
                defaultI: 0.01,
                defaultEpsilon: 0.40,
                agents: [
                    { name: 'Traditional Women', framework: 'Care Ethics', initialATCF: 0.85, beliefs: [{text: 'Trees = survival', strength: 95}], capabilities: [{name: 'Planting', level: 0.9}] },
                    { name: 'Environmental Scientists', framework: 'Consequentialism', initialATCF: 0.80, beliefs: [{text: 'Restore ecosystems', strength: 90}], capabilities: [{name: 'Ecology', level: 0.95}] },
                    { name: 'Feminist Activists', framework: 'Deontology', initialATCF: 0.85, beliefs: [{text: 'Women\'s empowerment', strength: 90}], capabilities: [{name: 'Organizing', level: 0.85}] },
                    { name: 'Religious Leaders', framework: 'Virtue Ethics', initialATCF: 0.80, beliefs: [{text: 'Stewardship duty', strength: 85}], capabilities: [{name: 'Community', level: 0.8}] }
                ]
            },
            {
                id: 'climate-change',
                title: 'Climate Change',
                period: '2015-present',
                week: 4,
                framework: 'Traditional Frameworks Failing',
                description: 'Paris Agreement coordination. Why do traditional frameworks struggle at planetary scale with existential stakes?',
                learningGoal: 'Understand why value pluralism + existential stakes require capability-based coordination',
                task: { description: 'Limit global warming to 1.5Â°C', successCriteria: 'Coordinate 195 nations with incompatible value systems' },
                defaultI: 0.35,
                defaultEpsilon: 0.20,
                agents: [
                    { name: 'Developed Nations', framework: 'Mixed', initialATCF: 0.75, beliefs: [{text: 'Economic growth priority', strength: 80}], capabilities: [{name: 'Technology', level: 0.85}] },
                    { name: 'Developing Nations', framework: 'Mixed', initialATCF: 0.75, beliefs: [{text: 'Development right', strength: 85}], capabilities: [{name: 'Resources', level: 0.6}] },
                    { name: 'Indigenous Communities', framework: 'Mixed', initialATCF: 0.80, beliefs: [{text: 'Land stewardship', strength: 90}], capabilities: [{name: 'Traditional knowledge', level: 0.8}] },
                    { name: 'Climate Scientists', framework: 'Mixed', initialATCF: 0.85, beliefs: [{text: 'Urgent action needed', strength: 95}], capabilities: [{name: 'Research', level: 0.95}] }
                ]
            },
            {
                id: 'ai-safety',
                title: 'AI Safety',
                period: '2025-2035',
                week: 4,
                framework: 'Complexity Ethics Required',
                description: 'Coordinating safe AI development across nations, corporations, and cultures with fundamentally different values.',
                learningGoal: 'Apply complexity ethics to novel challenges requiring coordination despite uncertainty and disagreement',
                task: { description: 'Ensure safe AGI development', successCriteria: 'Coordinate researchers, governments, ethicists, public across value differences' },
                defaultI: 0.15,
                defaultEpsilon: 0.45,
                agents: [
                    { name: 'AI Researchers', framework: 'Mixed', initialATCF: 0.85, beliefs: [{text: 'Technical safety focus', strength: 90}], capabilities: [{name: 'AI development', level: 0.95}] },
                    { name: 'Government Regulators', framework: 'Mixed', initialATCF: 0.80, beliefs: [{text: 'National security', strength: 85}], capabilities: [{name: 'Policy', level: 0.75}] },
                    { name: 'Ethicists', framework: 'Mixed', initialATCF: 0.85, beliefs: [{text: 'Value alignment', strength: 90}], capabilities: [{name: 'Ethics', level: 0.9}] },
                    { name: 'Public Representatives', framework: 'Mixed', initialATCF: 0.75, beliefs: [{text: 'Democratic input', strength: 80}], capabilities: [{name: 'Advocacy', level: 0.7}] }
                ]
            }
        ];

        // ========== ALL 5 PHILOSOPHERS ==========
        const philosophers = [
            {
                id: 'aristotle',
                name: 'Aristotle',
                dates: '384-322 BCE',
                tradition: 'Virtue Ethics',
                image: 'ðï¸',
                prfProfile: {
                    beliefs: [
                        { text: 'Human nature has inherent purpose (telos)', strength: 95 },
                        { text: 'Excellence achieved through habituation', strength: 90 },
                        { text: 'Practical wisdom guides ethical action', strength: 95 },
                        { text: 'Character development requires community', strength: 85 }
                    ],
                    rules: ['Observe excellent exemplars systematically', 'Practice virtues until they become habitual', 'Seek the mean between extremes', 'Develop phronesis (practical wisdom) through experience'],
                    ontology: 'Teleological view of nature; everything has proper function and purpose. Reality understood through four causes. Hierarchical natural order.',
                    authenticity: 'Excellence emerges from fulfilling one\'s proper function within community. Authentic living means actualizing human potential through virtuous character.'
                },
                ethicalFramework: {
                    keyQuestion: 'What kind of person should I become?',
                    focus: 'Character development and human flourishing',
                    strengths: ['Emphasizes long-term character over isolated acts', 'Integrates emotion and reason', 'Recognizes role of community and exemplars', 'Provides rich conception of good life'],
                    limitations: ['Requires shared conception of human nature', 'May reinforce existing hierarchies', 'Difficult to apply across cultural differences', 'Less clear guidance for novel situations']
                },
                modernRelevance: ['Professional ethics (medicine, law, business)', 'Character education in schools', 'Leadership development programs', 'Community-based moral formation']
            },
            {
                id: 'kant',
                name: 'Immanuel Kant',
                dates: '1724-1804',
                tradition: 'Deontology',
                image: 'âï¸',
                prfProfile: {
                    beliefs: [
                        { text: 'Rationality defines human dignity', strength: 100 },
                        { text: 'Moral law discoverable by reason alone', strength: 95 },
                        { text: 'Autonomy is fundamental to ethics', strength: 95 },
                        { text: 'Duty supersedes inclination', strength: 90 }
                    ],
                    rules: ['Act only on maxims you can will as universal law', 'Treat persons as ends in themselves, never merely as means', 'Act as if legislating for a kingdom of ends', 'Test moral principles for logical consistency'],
                    ontology: 'Noumenal/phenomenal distinction. Freedom exists in noumenal realm. Humans belong to both natural world (causally determined) and moral world (free).',
                    authenticity: 'Acting from duty to rational moral law, not from inclination or emotion. Authentic moral agency requires autonomous rational will.'
                },
                ethicalFramework: {
                    keyQuestion: 'What principle should guide this action?',
                    focus: 'Universal moral principles and human dignity',
                    strengths: ['Provides clear, universal guidance', 'Respects human autonomy and dignity', 'Not dependent on consequences or culture', 'Explains strong moral intuitions about rights'],
                    limitations: ['May produce counterintuitive results in edge cases', 'Struggles with conflicting duties', 'Abstract and difficult to apply', 'Assumes cross-cultural rational agreement possible']
                },
                modernRelevance: ['Human rights frameworks and international law', 'Medical ethics (informed consent, autonomy)', 'Business ethics (stakeholder theory)', 'AI ethics (dignity, autonomy, universal principles)']
            },
            {
                id: 'mill',
                name: 'John Stuart Mill',
                dates: '1806-1873',
                tradition: 'Consequentialism',
                image: 'ð',
                prfProfile: {
                    beliefs: [
                        { text: 'Pleasure and pain are objective measures', strength: 85 },
                        { text: 'Higher pleasures exist (intellectual, moral)', strength: 90 },
                        { text: 'Equal consideration of all interests', strength: 95 },
                        { text: 'Social reform through evidence and reason', strength: 90 }
                    ],
                    rules: ['Calculate expected outcomes for all affected', 'Maximize overall happiness (utility)', 'Consider quality as well as quantity of pleasure', 'Weight long-term over short-term consequences'],
                    ontology: 'Naturalistic worldview. No supernatural entities needed for ethics. Empiricist epistemology - knowledge from experience.',
                    authenticity: 'Moral progress through evidence-based reform. Authentic moral agency means using reason to reduce suffering and increase happiness.'
                },
                ethicalFramework: {
                    keyQuestion: 'What outcome will maximize well-being?',
                    focus: 'Consequences and overall welfare',
                    strengths: ['Clear decision procedure for moral choices', 'Impartial consideration of all affected', 'Adapts to new information and contexts', 'Practical and action-guiding'],
                    limitations: ['Difficult to predict all consequences', 'May justify intuitively wrong actions', 'Measurement challenges for happiness', 'Can neglect individual rights and justice']
                },
                modernRelevance: ['Cost-benefit analysis in policy', 'Effective Altruism and global poverty reduction', 'Environmental ethics (sentience-based)', 'Public health ethics (population-level outcomes)']
            },
            {
                id: 'gilligan',
                name: 'Carol Gilligan',
                dates: '1936-present',
                tradition: 'Care Ethics',
                image: 'ð¤',
                prfProfile: {
                    beliefs: [
                        { text: 'Relationships constitute personhood', strength: 95 },
                        { text: 'Care is moral foundation, not derived principle', strength: 90 },
                        { text: 'Context matters for ethical judgment', strength: 95 },
                        { text: 'Different moral voices are equally valid', strength: 90 }
                    ],
                    rules: ['Attend to contextual details and relationships', 'Maintain caring connections', 'Listen to different moral voices', 'Recognize interdependence as primary'],
                    ontology: 'Relational ontology. Persons are fundamentally connected, not atomistic individuals. Identity formed through relationships.',
                    authenticity: 'Feminist consciousness integrating theory with lived experience. Authentic ethics emerges from voices previously silenced.'
                },
                ethicalFramework: {
                    keyQuestion: 'How do I maintain caring relationships?',
                    focus: 'Relationships, context, and responsibility',
                    strengths: ['Recognizes moral dimensions invisible to abstract principle', 'Values emotional and contextual factors', 'Challenges masculine bias in traditional ethics', 'Emphasizes concrete human needs'],
                    limitations: ['May struggle to scale beyond personal relationships', 'Risk of parochialism (favoring "our" people)', 'Lacks clear decision procedures', 'Could reinforce gender stereotypes if misapplied']
                },
                modernRelevance: ['Healthcare ethics (patient-centered care)', 'Education (relational pedagogy)', 'Environmental ethics (land as relationship)', 'Conflict resolution (restorative justice)']
            },
            {
                id: 'singer',
                name: 'Peter Singer',
                dates: '1946-present',
                tradition: 'Consequentialism',
                image: 'ð',
                prfProfile: {
                    beliefs: [
                        { text: 'Suffering is objectively bad regardless of species', strength: 95 },
                        { text: 'Equal consideration of equal interests', strength: 100 },
                        { text: 'We can calculate and compare welfare', strength: 85 },
                        { text: 'Affluent people have strong obligations to help', strength: 90 }
                    ],
                    rules: ['Give equal weight to equal interests', 'Prevent suffering when possible at reasonable cost', 'Consider all sentient beings in moral calculations', 'Prioritize effective interventions'],
                    ontology: 'Naturalistic worldview. Sentience (capacity for suffering/wellbeing) is basis for moral consideration. No morally relevant human essence beyond sentience.',
                    authenticity: 'Moral progress through consistent application of impartial reason. Authentic ethics means following evidence about suffering wherever it leads.'
                },
                ethicalFramework: {
                    keyQuestion: 'How can I most effectively reduce suffering?',
                    focus: 'Impartial welfare maximization and effective altruism',
                    strengths: ['Clear guidance for global poverty and animal welfare', 'Consistent application across species boundaries', 'Evidence-based and empirically tractable', 'Motivates significant real-world impact'],
                    limitations: ['Potentially counterintuitive implications', 'May ignore special obligations (family, community)', 'Demanding moral requirements', 'Controversial views on disability and euthanasia']
                },
                modernRelevance: ['Effective Altruism and charity evaluation', 'Animal welfare and factory farming reform', 'Global health interventions', 'Existential risk prioritization']
            }
        ];

        // ========== SIMULATION FUNCTIONS ==========
        function calculateSuccessProbability(agents, I, epsilon) {
            let prob = 0.5 - (I * 0.15) + (epsilon * 0.3);
            const avgCap = agents.reduce((sum, a) => sum + (a.capabilities[0]?.level || 0.5), 0) / agents.length;
            prob += (avgCap - 0.5) * 0.2;
            const diversity = agents.length > 1 ? 0.3 : 0;
            prob -= diversity * (1 - epsilon) * 0.15;
            return Math.max(0.05, Math.min(0.95, prob));
        }

        function calculateATCF(agent, I, epsilon, timeStep) {
            let atcf = agent.initialATCF || 0.8;
            atcf -= I * 0.1;
            atcf += epsilon * 0.15;
            atcf -= timeStep * 0.02;
            const resilience = agent.beliefs?.[0]?.strength || 70;
            atcf += (resilience - 70) / 1000;
            return Math.max(0.1, Math.min(1.0, atcf));
        }

        function runEnsemble(scenario, numRuns = 20, numSteps = 10) {
            const results = {
                runs: [],
                summary: { avgSuccessRate: 0, avgFinalATCF: 0, robustness: 0 },
                timeSeriesData: Array.from({length: numSteps}, (_, i) => ({ 
                    time: i + 1, avgSuccess: 0, avgATCF: 0, runs: [] 
                }))
            };

            let totalSuccesses = 0, totalFinalATCF = 0;

            for (let run = 0; run < numRuns; run++) {
                const runData = { runNumber: run + 1, steps: [] };
                
                for (let step = 0; step < numSteps; step++) {
                    const successProb = calculateSuccessProbability(scenario.agents, scenario.defaultI, scenario.defaultEpsilon);
                    const success = Math.random() < successProb;
                    const avgATCF = scenario.agents.reduce((sum, a) => 
                        sum + calculateATCF(a, scenario.defaultI, scenario.defaultEpsilon, step), 0
                    ) / scenario.agents.length;

                    runData.steps.push({ step: step + 1, success, avgATCF });
                    results.timeSeriesData[step].runs.push({ success: success ? 1 : 0, atcf: avgATCF });
                }

                const finalStep = runData.steps[numSteps - 1];
                totalSuccesses += finalStep.success ? 1 : 0;
                totalFinalATCF += finalStep.avgATCF;
                results.runs.push(runData);
            }

            results.timeSeriesData.forEach(tp => {
                tp.avgSuccess = tp.runs.reduce((s, r) => s + r.success, 0) / tp.runs.length * 100;
                tp.avgATCF = tp.runs.reduce((s, r) => s + r.atcf, 0) / tp.runs.length;
            });

            results.summary.avgSuccessRate = (totalSuccesses / numRuns) * 100;
            results.summary.avgFinalATCF = totalFinalATCF / numRuns;
            
            const successRates = results.runs.map(r => r.steps[numSteps-1].success ? 100 : 0);
            const variance = successRates.reduce((sum, sr) => 
                sum + Math.pow(sr - results.summary.avgSuccessRate, 2), 0
            ) / numRuns;
            results.summary.robustness = Math.max(0, 100 - Math.sqrt(variance));

            return results;
        }

        // ========== SIMPLE CHART COMPONENT ==========
        function SimpleChart({ data, title }) {
            const maxValue = Math.max(...data.map(d => Math.max(d.avgSuccess, d.avgATCF)));
            
            return (
                <div>
                    <h4 className="text-lg font-semibold text-gray-800 mb-4">{title}</h4>
                    <div className="chart-container bg-gray-50">
                        <div className="flex justify-between h-full items-end px-2">
                            {data.map((d, i) => (
                                <div key={i} className="flex-1 flex flex-col items-center justify-end h-full">
                                    <div className="flex gap-1 items-end w-full justify-center" style={{height: '90%'}}>
                                        <div 
                                            className="chart-bar bg-blue-500"
                                            style={{
                                                height: `${(d.avgSuccess / maxValue) * 100}%`,
                                                width: '8px'
                                            }}
                                            title={`Success: ${d.avgSuccess.toFixed(1)}%`}
                                        ></div>
                                        <div 
                                            className="chart-bar bg-green-500"
                                            style={{
                                                height: `${(d.avgATCF / maxValue) * 100}%`,
                                                width: '8px'
                                            }}
                                            title={`ATCF: ${d.avgATCF.toFixed(1)}%`}
                                        ></div>
                                    </div>
                                    <span className="text-xs text-gray-500 mt-2">{d.time}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="flex justify-center gap-6 mt-4 text-sm">
                        <div className="flex items-center gap-2">
                            <div className="w-4 h-4 bg-blue-500 rounded"></div>
                            <span>Success Rate (%)</span>
                        </div>
                        <div className="flex items-center gap-2">
                            <div className="w-4 h-4 bg-green-500 rounded"></div>
                            <span>Avg ATCF (%)</span>
                        </div>
                    </div>
                </div>
            );
        }

        // ========== MAIN APP COMPONENT ==========
        function App() {
            const [page, setPage] = useState('home');
            const [scenario, setScenario] = useState(null);
            const [selectedWeek, setSelectedWeek] = useState('all');
            const [I, setI] = useState(0.2);
            const [epsilon, setEpsilon] = useState(0.3);
            const [results, setResults] = useState(null);
            const [isRunning, setIsRunning] = useState(false);

            const handleNavigate = (newPage) => {
                setPage(newPage);
                window.scrollTo(0, 0);
            };

            const handleSelectScenario = (s) => {
                setScenario(s);
                setI(s.defaultI);
                setEpsilon(s.defaultEpsilon);
                setResults(null);
            };

            const handleRunSimulation = () => {
                if (!scenario) return;
                setIsRunning(true);
                setTimeout(() => {
                    const modScenario = { ...scenario, defaultI: I, defaultEpsilon: epsilon };
                    const ensembleResults = runEnsemble(modScenario);
                    setResults(ensembleResults);
                    setIsRunning(false);
                }, 500);
            };

            const filteredScenarios = selectedWeek === 'all' 
                ? scenarios 
                : scenarios.filter(s => s.week === parseInt(selectedWeek));

            return (
                <div className="min-h-screen bg-gray-100">
                    {/* Navigation */}
                    <nav className="bg-white shadow-md sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4">
                            <div className="flex justify-between items-center h-16">
                                <button onClick={() => handleNavigate('home')} 
                                        className="text-xl font-bold text-gray-800 hover:text-blue-600 transition-colors">
                                    Ethics Lab
                                </button>
                                <div className="flex gap-1">
                                    {[
                                        {id: 'home', label: 'Home', icon: 'ð '},
                                        {id: 'scenarios', label: 'Scenarios', icon: 'ð­'},
                                        {id: 'simulator', label: 'Simulator', icon: 'âï¸'},
                                        {id: 'philosophers', label: 'Philosophers', icon: 'ð§ '}
                                    ].map(nav => (
                                        <button key={nav.id} onClick={() => handleNavigate(nav.id)}
                                                className={`px-4 py-2 rounded-lg transition-colors ${
                                                    page === nav.id 
                                                    ? 'bg-blue-600 text-white' 
                                                    : 'text-gray-700 hover:bg-gray-100'
                                                }`}>
                                            <span className="hidden md:inline">{nav.icon} {nav.label}</span>
                                            <span className="md:hidden">{nav.icon}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="max-w-7xl mx-auto px-4 py-8">
                        {/* HOME PAGE */}
                        {page === 'home' && (
                            <div className="max-w-4xl mx-auto">
                                <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-8 mb-8">
                                    <h1 className="text-4xl font-bold mb-4">Ethics Assembly History Lab</h1>
                                    <p className="text-xl">From Ancient Wisdom to Planetary Coordination</p>
                                </div>

                                <div className="grid md:grid-cols-2 gap-6 mb-8">
                                    <div className="bg-white rounded-lg shadow-md p-6">
                                        <h2 className="text-2xl font-semibold mb-3 text-gray-800">ð Module Overview</h2>
                                        <p className="text-gray-600 mb-4">
                                            A 4-week interactive journey exploring how ethical frameworks emerged from specific historical contexts
                                        </p>
                                        <div className="space-y-2 text-sm">
                                            <div><span className="font-semibold text-blue-600">Week 1:</span> Discovery - Why disagree?</div>
                                            <div><span className="font-semibold text-green-600">Week 2:</span> History - When frameworks work?</div>
                                            <div><span className="font-semibold text-purple-600">Week 3:</span> Coordination emerges</div>
                                            <div><span className="font-semibold text-red-600">Week 4:</span> Planetary challenges</div>
                                        </div>
                                    </div>

                                    <div className="bg-white rounded-lg shadow-md p-6">
                                        <h2 className="text-2xl font-semibold mb-3 text-gray-800">ð¯ Learning Goals</h2>
                                        <ul className="space-y-2 text-sm">
                                            <li className="flex items-start">
                                                <span className="text-green-500 mr-2">â</span>
                                                <span>Understand your ethical PRF</span>
                                            </li>
                                            <li className="flex items-start">
                                                <span className="text-green-500 mr-2">â</span>
                                                <span>Trace philosophers' assembly histories</span>
                                            </li>
                                            <li className="flex items-start">
                                                <span className="text-green-500 mr-2">â</span>
                                                <span>Master I/H/ATCF tradeoffs</span>
                                            </li>
                                            <li className="flex items-start">
                                                <span className="text-green-500 mr-2">â</span>
                                                <span>Coordinate across differences</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                                <div className="bg-blue-50 rounded-lg p-6 mb-8">
                                    <h2 className="text-2xl font-semibold mb-4 text-gray-800">ð ï¸ Interactive Tools</h2>
                                    <div className="grid md:grid-cols-3 gap-4">
                                        <button onClick={() => handleNavigate('scenarios')} 
                                                className="bg-white rounded-lg p-4 shadow hover:shadow-lg transition-shadow text-left">
                                            <div className="text-3xl mb-2">ð­</div>
                                            <h3 className="font-semibold text-gray-800 mb-1">Historical Scenarios</h3>
                                            <p className="text-sm text-gray-600">6 cases from Athens to AI Safety</p>
                                        </button>
                                        <button onClick={() => handleNavigate('philosophers')}
                                                className="bg-white rounded-lg p-4 shadow hover:shadow-lg transition-shadow text-left">
                                            <div className="text-3xl mb-2">ð§ </div>
                                            <h3 className="font-semibold text-gray-800 mb-1">Philosopher Database</h3>
                                            <p className="text-sm text-gray-600">5 complete PRF profiles</p>
                                        </button>
                                        <button onClick={() => handleNavigate('simulator')}
                                                className="bg-white rounded-lg p-4 shadow hover:shadow-lg transition-shadow text-left">
                                            <div className="text-3xl mb-2">âï¸</div>
                                            <h3 className="font-semibold text-gray-800 mb-1">Coalition Simulator</h3>
                                            <p className="text-sm text-gray-600">Run ensemble simulations</p>
                                        </button>
                                    </div>
                                </div>

                                <div className="bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg p-6">
                                    <h2 className="text-2xl font-semibold mb-3 text-gray-800">ð The Big Insight</h2>
                                    <p className="text-gray-700 mb-3">
                                        Traditional ethics asks: <em>"Which framework is right?"</em>
                                    </p>
                                    <p className="text-gray-700 font-semibold">
                                        Complexity ethics asks: <em>"How do we coordinate across frameworks?"</em>
                                    </p>
                                </div>
                            </div>
                        )}

                        {/* SCENARIOS PAGE */}
                        {page === 'scenarios' && (
                            <div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Historical Scenarios Library</h1>
                                <p className="text-gray-600 mb-6">Explore 6 historical cases showing when ethical frameworks work and fail</p>
                                
                                {/* Week Filter */}
                                <div className="mb-6 flex gap-2 flex-wrap">
                                    <button
                                        onClick={() => setSelectedWeek('all')}
                                        className={`px-4 py-2 rounded-lg transition-colors ${
                                            selectedWeek === 'all' 
                                            ? 'bg-gray-800 text-white' 
                                            : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                        }`}>
                                        All Scenarios
                                    </button>
                                    {[1, 2, 3, 4].map(week => (
                                        <button
                                            key={week}
                                            onClick={() => setSelectedWeek(week.toString())}
                                            className={`px-4 py-2 rounded-lg transition-colors ${
                                                selectedWeek === week.toString()
                                                ? 'bg-gray-800 text-white'
                                                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }`}>
                                            Week {week}
                                        </button>
                                    ))}
                                </div>

                                <div className="grid md:grid-cols-2 gap-6">
                                    {filteredScenarios.map(s => (
                                        <div key={s.id} className="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                                            <div className="bg-gradient-to-r from-gray-700 to-gray-900 text-white p-4">
                                                <div className="flex justify-between items-start mb-2">
                                                    <h2 className="text-xl font-bold">{s.title}</h2>
                                                    <span className="px-2 py-1 bg-blue-200 text-blue-900 text-xs font-semibold rounded">
                                                        Week {s.week}
                                                    </span>
                                                </div>
                                                <p className="text-sm text-gray-300">{s.period}</p>
                                            </div>
                                            <div className="p-4">
                                                <p className="text-gray-700 mb-4 text-sm">{s.description}</p>
                                                <div className="mb-3">
                                                    <span className="text-sm font-semibold text-gray-600">Framework:</span>
                                                    <span className="ml-2 text-sm text-gray-800">{s.framework}</span>
                                                </div>
                                                <div className="bg-blue-50 rounded p-3 mb-4">
                                                    <p className="text-sm font-semibold text-blue-800 mb-1">ð¯ Learning Goal:</p>
                                                    <p className="text-sm text-gray-700">{s.learningGoal}</p>
                                                </div>
                                                <div className="grid grid-cols-3 gap-2 mb-4 text-center">
                                                    <div className="bg-gray-100 rounded p-2">
                                                        <p className="text-xs text-gray-600">Protocol (I)</p>
                                                        <p className="text-lg font-bold text-gray-800">{s.defaultI}</p>
                                                    </div>
                                                    <div className="bg-gray-100 rounded p-2">
                                                        <p className="text-xs text-gray-600">Tolerance (Îµ)</p>
                                                        <p className="text-lg font-bold text-gray-800">{s.defaultEpsilon}</p>
                                                    </div>
                                                    <div className="bg-gray-100 rounded p-2">
                                                        <p className="text-xs text-gray-600">Agents</p>
                                                        <p className="text-lg font-bold text-gray-800">{s.agents.length}</p>
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => { handleSelectScenario(s); handleNavigate('simulator'); }}
                                                    className="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                                                    Run This Scenario
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* SIMULATOR PAGE */}
                        {page === 'simulator' && (
                            <div>
                                {!scenario ? (
                                    <div className="max-w-4xl mx-auto text-center py-12">
                                        <div className="text-6xl mb-4">ð­</div>
                                        <h2 className="text-2xl font-bold text-gray-800 mb-4">No Scenario Selected</h2>
                                        <p className="text-gray-600 mb-6">Select a scenario from the library to begin simulation</p>
                                        <button onClick={() => handleNavigate('scenarios')} 
                                                className="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                                            Browse Scenarios
                                        </button>
                                    </div>
                                ) : (
                                    <div>
                                        <button onClick={() => handleNavigate('scenarios')} 
                                                className="text-blue-600 hover:text-blue-800 mb-4 flex items-center gap-1">
                                            â Back to Scenarios
                                        </button>
                                        <h1 className="text-3xl font-bold text-gray-800 mb-2">{scenario.title}</h1>
                                        <p className="text-gray-600 mb-6">{scenario.period}</p>
                                        
                                        <div className="grid lg:grid-cols-3 gap-6">
                                            {/* Controls */}
                                            <div className="bg-white rounded-lg shadow-md p-6 lg:sticky lg:top-20 h-fit">
                                                <h2 className="text-xl font-semibold text-gray-800 mb-4">Simulation Controls</h2>
                                                <div className="mb-6 p-3 bg-blue-50 rounded">
                                                    <p className="text-sm font-semibold text-blue-800 mb-1">Coalition Task:</p>
                                                    <p className="text-sm text-gray-700">{scenario.task.description}</p>
                                                </div>
                                                <div className="space-y-6">
                                                    <div>
                                                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                            Protocol Complexity (I): {I.toFixed(2)}
                                                        </label>
                                                        <input type="range" min="0" max="1" step="0.05" value={I}
                                                               onChange={(e) => setI(parseFloat(e.target.value))}
                                                               className="w-full" />
                                                        <p className="text-xs text-gray-500 mt-1">Higher I = more rules, more friction</p>
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                            Tolerance for Difference (Îµ): {epsilon.toFixed(2)}
                                                        </label>
                                                        <input type="range" min="0" max="1" step="0.05" value={epsilon}
                                                               onChange={(e) => setEpsilon(parseFloat(e.target.value))}
                                                               className="w-full" />
                                                        <p className="text-xs text-gray-500 mt-1">Higher Îµ = more tolerance for different approaches</p>
                                                    </div>
                                                    <button onClick={handleRunSimulation} disabled={isRunning}
                                                            className={`w-full py-3 rounded-lg font-semibold transition-colors ${
                                                                isRunning 
                                                                ? 'bg-gray-400 text-gray-200 cursor-not-allowed' 
                                                                : 'bg-blue-600 text-white hover:bg-blue-700'
                                                            }`}>
                                                        {isRunning ? 'Running Simulation...' : 'Run Simulation'}
                                                    </button>
                                                </div>
                                                <div className="mt-6">
                                                    <h3 className="text-sm font-semibold text-gray-700 mb-2">Stakeholder Groups:</h3>
                                                    <div className="space-y-2">
                                                        {scenario.agents.map((agent, idx) => (
                                                            <div key={idx} className="text-sm p-2 bg-gray-50 rounded">
                                                                <p className="font-semibold text-gray-800">{agent.name}</p>
                                                                <p className="text-xs text-gray-600">{agent.framework}</p>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* Results */}
                                            <div className="lg:col-span-2">
                                                {!results ? (
                                                    <div className="bg-white rounded-lg shadow-md p-12 text-center">
                                                        <div className="text-6xl mb-4">âï¸</div>
                                                        <h3 className="text-xl font-semibold text-gray-800 mb-2">Ready to Simulate</h3>
                                                        <p className="text-gray-600">Adjust parameters on the left and click "Run Simulation" to see results</p>
                                                    </div>
                                                ) : (
                                                    <div className="space-y-6">
                                                        <div className="bg-white rounded-lg shadow-md p-6">
                                                            <h3 className="text-xl font-semibold text-gray-800 mb-4">Summary Statistics</h3>
                                                            <div className="grid grid-cols-3 gap-4">
                                                                <div className="text-center p-4 bg-blue-50 rounded-lg">
                                                                    <p className="text-3xl font-bold text-blue-600">
                                                                        {results.summary.avgSuccessRate.toFixed(0)}%
                                                                    </p>
                                                                    <p className="text-sm text-gray-600 mt-1">Success Rate</p>
                                                                </div>
                                                                <div className="text-center p-4 bg-green-50 rounded-lg">
                                                                    <p className="text-3xl font-bold text-green-600">
                                                                        {(results.summary.avgFinalATCF * 100).toFixed(0)}%
                                                                    </p>
                                                                    <p className="text-sm text-gray-600 mt-1">Final ATCF</p>
                                                                </div>
                                                                <div className="text-center p-4 bg-purple-50 rounded-lg">
                                                                    <p className="text-3xl font-bold text-purple-600">
                                                                        {results.summary.robustness.toFixed(0)}%
                                                                    </p>
                                                                    <p className="text-sm text-gray-600 mt-1">Robustness</p>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div className="bg-white rounded-lg shadow-md p-6">
                                                            <SimpleChart data={results.timeSeriesData} title="Performance Over Time" />
                                                        </div>

                                                        <div className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-6">
                                                            <h3 className="text-lg font-semibold text-gray-800 mb-2">ð¯ Learning Goal</h3>
                                                            <p className="text-gray-700">{scenario.learningGoal}</p>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* PHILOSOPHERS PAGE */}
                        {page === 'philosophers' && (
                            <div>
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Philosopher Database</h1>
                                <p className="text-gray-600 mb-6">Explore how different philosophers' assembly histories shaped their ethical frameworks</p>
                                
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {philosophers.map(p => (
                                        <div key={p.id} className="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
                                            <div className="bg-gradient-to-r from-gray-700 to-gray-900 text-white p-6 text-center">
                                                <div className="text-5xl mb-3">{p.image}</div>
                                                <h2 className="text-xl font-bold">{p.name}</h2>
                                                <p className="text-sm text-gray-300">{p.dates}</p>
                                            </div>
                                            <div className="p-4">
                                                <div className="mb-4">
                                                    <span className="inline-block px-3 py-1 bg-purple-100 text-purple-800 text-sm font-semibold rounded-full">
                                                        {p.tradition}
                                                    </span>
                                                </div>
                                                <div className="mb-4">
                                                    <p className="text-sm font-semibold text-gray-700 mb-1">Key Question:</p>
                                                    <p className="text-sm text-gray-600 italic">"{p.ethicalFramework.keyQuestion}"</p>
                                                </div>
                                                <div className="mb-4">
                                                    <p className="text-sm font-semibold text-gray-700 mb-1">Focus:</p>
                                                    <p className="text-sm text-gray-600">{p.ethicalFramework.focus}</p>
                                                </div>
                                                <div className="mb-4">
                                                    <p className="text-sm font-semibold text-gray-700 mb-2">Core Beliefs:</p>
                                                    <div className="space-y-2">
                                                        {p.prfProfile.beliefs.slice(0, 2).map((belief, idx) => (
                                                            <div key={idx}>
                                                                <div className="flex items-center text-xs mb-1">
                                                                    <div className="w-16 bg-gray-200 rounded-full h-2 mr-2">
                                                                        <div className="bg-blue-600 h-2 rounded-full" 
                                                                             style={{width: `${belief.strength}%`}}></div>
                                                                    </div>
                                                                    <span className="text-gray-600">{belief.text.substring(0, 30)}...</span>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-3">
                                                    <div>
                                                        <p className="text-xs font-semibold text-green-700 mb-1">â Strengths</p>
                                                        <ul className="text-xs text-gray-600 space-y-1">
                                                            {p.ethicalFramework.strengths.slice(0, 2).map((s, i) => (
                                                                <li key={i} className="flex items-start">
                                                                    <span className="text-green-500 mr-1">+</span>
                                                                    <span className="text-xs">{s.substring(0, 40)}...</span>
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                    <div>
                                                        <p className="text-xs font-semibold text-red-700 mb-1">â  Limits</p>
                                                        <ul className="text-xs text-gray-600 space-y-1">
                                                            {p.ethicalFramework.limitations.slice(0, 2).map((l, i) => (
                                                                <li key={i} className="flex items-start">
                                                                    <span className="text-red-500 mr-1">-</span>
                                                                    <span className="text-xs">{l.substring(0, 40)}...</span>
                                                                </li>
                                                            ))}
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div className="mt-4">
                                                    <p className="text-xs font-semibold text-gray-700 mb-1">ð Modern Relevance:</p>
                                                    <div className="flex flex-wrap gap-1">
                                                        {p.modernRelevance.slice(0, 2).map((area, i) => (
                                                            <span key={i} className="px-2 py-1 bg-blue-50 text-blue-700 text-xs rounded">
                                                                {area.substring(0, 25)}{area.length > 25 ? '...' : ''}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="mt-8 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6">
                                    <h3 className="text-xl font-semibold text-gray-800 mb-3">ð Coordination Insight</h3>
                                    <p className="text-gray-700 mb-3">
                                        These philosophers developed fundamentally different frameworks from their distinct assembly histories and cultural contexts.
                                    </p>
                                    <p className="text-gray-700 mb-3">
                                        <strong>Traditional ethics asks:</strong> Which framework is correct?
                                    </p>
                                    <p className="text-gray-700 font-semibold">
                                        <strong>Complexity ethics enables:</strong> Coordination through functional equivalence - 
                                        they can work toward shared outcomes while maintaining their authentic frameworks.
                                    </p>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="bg-gray-800 text-white mt-16 py-8">
                        <div className="max-w-7xl mx-auto px-4">
                            <div className="grid md:grid-cols-3 gap-8 mb-8">
                                <div>
                                    <h3 className="text-lg font-semibold mb-3">Ethics Assembly History Lab</h3>
                                    <p className="text-gray-400 text-sm">
                                        An interactive module exploring how ethical frameworks emerged from specific historical contexts and how we coordinate across them today.
                                    </p>
                                </div>
                                <div>
                                    <h3 className="text-lg font-semibold mb-3">Quick Links</h3>
                                    <div className="space-y-2">
                                        <button onClick={() => handleNavigate('scenarios')} 
                                                className="block text-gray-400 hover:text-white text-sm transition-colors">
                                            Historical Scenarios
                                        </button>
                                        <button onClick={() => handleNavigate('philosophers')} 
                                                className="block text-gray-400 hover:text-white text-sm transition-colors">
                                            Philosopher Database
                                        </button>
                                        <button onClick={() => handleNavigate('simulator')} 
                                                className="block text-gray-400 hover:text-white text-sm transition-colors">
                                            Coalition Simulator
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <h3 className="text-lg font-semibold mb-3">About</h3>
                                    <p className="text-gray-400 text-sm mb-2">
                                        Part of the Capability-Based Coordination framework
                                    </p>
                                    <p className="text-gray-400 text-sm">
                                        Based on FAIM-QIRF theoretical foundations
                                    </p>
                                </div>
                            </div>
                            <div className="pt-8 border-t border-gray-700 text-center">
                                <p className="text-gray-400 text-sm">Â© 2025 Ethics Lab. Built for educational purposes.</p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        // ========== RENDER ==========
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
