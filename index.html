<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethics Assembly History Lab</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f3f4f6;
        }
        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            padding: 20px;
        }
        .loading-screen h1 { 
            color: #2563eb; 
            margin-bottom: 20px;
            font-size: 2rem;
        }
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2563eb;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error-message {
            color: #dc2626;
            background: #fee2e2;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            max-width: 600px;
        }
        #status { color: #6b7280; margin-top: 10px; }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading-screen">
            <h1>Ethics Assembly History Lab</h1>
            <div class="spinner"></div>
            <div id="status">Loading libraries...</div>
        </div>
    </div>

    <!-- Load dependencies in correct order -->
    <script>
        let loadStatus = document.getElementById('status');
        let loadedLibs = {
            react: false,
            reactDom: false,
            babel: false,
            tailwind: false,
            recharts: false
        };

        function updateStatus(msg) {
            console.log(msg);
            if (loadStatus) loadStatus.textContent = msg;
        }

        function checkAllLoaded() {
            if (Object.values(loadedLibs).every(v => v)) {
                updateStatus('All libraries loaded! Starting app...');
                setTimeout(initApp, 100);
            }
        }

        function showError(msg) {
            document.getElementById('root').innerHTML = `
                <div class="loading-screen">
                    <h1>‚ö†Ô∏è Loading Error</h1>
                    <div class="error-message">
                        <strong>Error:</strong> ${msg}
                        <br><br>
                        <strong>Solutions:</strong>
                        <ul style="text-align: left; margin-top: 10px;">
                            <li>Check your internet connection</li>
                            <li>Try refreshing the page (Ctrl+R or Cmd+R)</li>
                            <li>Check browser console (F12) for details</li>
                            <li>Try a different browser</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // Set timeout for loading
        setTimeout(() => {
            if (!Object.values(loadedLibs).every(v => v)) {
                showError('Libraries failed to load after 30 seconds. Check console for details.');
            }
        }, 30000);
    </script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js" 
            onload="loadedLibs.react=true; updateStatus('React loaded...'); checkAllLoaded();"
            onerror="showError('Failed to load React from CDN')"></script>
    
    <!-- React DOM -->
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
            onload="loadedLibs.reactDom=true; updateStatus('React DOM loaded...'); checkAllLoaded();"
            onerror="showError('Failed to load React DOM from CDN')"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"
            onload="loadedLibs.babel=true; updateStatus('Babel loaded...'); checkAllLoaded();"
            onerror="showError('Failed to load Babel from CDN')"></script>
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"
            onload="loadedLibs.tailwind=true; updateStatus('Tailwind loaded...'); checkAllLoaded();"
            onerror="showError('Failed to load Tailwind from CDN')"></script>
    
    <!-- Recharts -->
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"
            onload="loadedLibs.recharts=true; updateStatus('Recharts loaded...'); checkAllLoaded();"
            onerror="showError('Failed to load Recharts from CDN')"></script>

    <script type="text/babel">
        function initApp() {
            try {
                updateStatus('Initializing application...');
                
                const { useState } = React;
                const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

                // Verify all dependencies
                if (!React || !ReactDOM || !Recharts) {
                    throw new Error('Required libraries not loaded');
                }

                // Simple test component first
                function TestApp() {
                    return (
                        <div style={{padding: '50px', textAlign: 'center'}}>
                            <h1 style={{color: '#2563eb', fontSize: '2rem', marginBottom: '20px'}}>
                                ‚úì Ethics Lab Loaded Successfully!
                            </h1>
                            <p style={{color: '#6b7280', marginBottom: '30px'}}>
                                All libraries are working. Building full application...
                            </p>
                        </div>
                    );
                }

                updateStatus('Rendering app...');
                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(<TestApp />);
                
                // After 2 seconds, load the full app
                setTimeout(loadFullApp, 2000);
                
            } catch (error) {
                console.error('Init error:', error);
                showError('Failed to initialize app: ' + error.message);
            }
        }

        function loadFullApp() {
            try {
                const { useState } = React;
                const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

                // DATA
                const scenarios = [
                    {
                        id: 'athens',
                        title: 'Ancient Athens',
                        period: '430 BCE',
                        week: 1,
                        framework: 'Virtue Ethics',
                        description: 'Athenian democracy during Peloponnesian War',
                        learningGoal: 'Understand when virtue ethics works',
                        task: { description: 'Coordinate to prevent Socrates execution' },
                        defaultI: 0.12,
                        defaultEpsilon: 0.15,
                        agents: [
                            { name: 'Philosophers', framework: 'Virtue Ethics', initialATCF: 0.85, capabilities: [{level: 0.9}] },
                            { name: 'Military', framework: 'Virtue Ethics', initialATCF: 0.80, capabilities: [{level: 0.85}] },
                            { name: 'Assembly', framework: 'Virtue Ethics', initialATCF: 0.75, capabilities: [{level: 0.75}] }
                        ]
                    }
                ];

                const philosophers = [
                    {
                        id: 'aristotle',
                        name: 'Aristotle',
                        dates: '384-322 BCE',
                        tradition: 'Virtue Ethics',
                        image: 'üèõÔ∏è',
                        keyQuestion: 'What kind of person should I become?',
                        beliefs: ['Human nature has purpose', 'Excellence through habit'],
                        strengths: ['Long-term character', 'Integrates emotion/reason'],
                        limitations: ['Requires shared nature concept', 'May reinforce hierarchies']
                    }
                ];

                // SIMULATION
                function runSimulation(scenario, I, epsilon) {
                    const results = [];
                    for (let t = 1; t <= 10; t++) {
                        const successRate = 50 + (epsilon * 30) - (I * 15) + Math.random() * 10;
                        const atcf = 80 - (I * 10) + (epsilon * 15) - (t * 2) + Math.random() * 5;
                        results.push({
                            time: t,
                            'Success Rate (%)': Math.max(0, Math.min(100, successRate)),
                            'Avg ATCF': Math.max(0, Math.min(100, atcf))
                        });
                    }
                    return {
                        timeSeriesData: results,
                        avgSuccess: results.reduce((s, r) => s + r['Success Rate (%)'], 0) / results.length,
                        avgATCF: results.reduce((s, r) => s + r['Avg ATCF'], 0) / results.length,
                        robustness: 75 + Math.random() * 20
                    };
                }

                // COMPONENTS
                function App() {
                    const [page, setPage] = useState('home');
                    const [scenario, setScenario] = useState(null);
                    const [I, setI] = useState(0.2);
                    const [epsilon, setEpsilon] = useState(0.3);
                    const [results, setResults] = useState(null);

                    const runSim = () => {
                        if (!scenario) return;
                        const res = runSimulation(scenario, I, epsilon);
                        setResults(res);
                    };

                    return (
                        <div className="min-h-screen bg-gray-100">
                            <nav className="bg-white shadow-md p-4">
                                <div className="max-w-7xl mx-auto flex justify-between items-center">
                                    <button onClick={() => setPage('home')} 
                                            className="text-xl font-bold text-gray-800">
                                        Ethics Lab
                                    </button>
                                    <div className="flex gap-2">
                                        {['home', 'scenarios', 'simulator', 'philosophers'].map(p => (
                                            <button key={p} onClick={() => setPage(p)}
                                                    className={`px-4 py-2 rounded ${page === p ? 'bg-blue-600 text-white' : 'bg-gray-200'}`}>
                                                {p.charAt(0).toUpperCase() + p.slice(1)}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            </nav>

                            <main className="max-w-7xl mx-auto p-8">
                                {page === 'home' && (
                                    <div className="max-w-4xl mx-auto">
                                        <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-8 mb-8">
                                            <h1 className="text-4xl font-bold mb-4">Ethics Assembly History Lab</h1>
                                            <p className="text-xl">From Ancient Wisdom to Planetary Coordination</p>
                                        </div>
                                        <div className="grid md:grid-cols-3 gap-4">
                                            <button onClick={() => setPage('scenarios')}
                                                    className="bg-white p-6 rounded-lg shadow hover:shadow-lg">
                                                <div className="text-4xl mb-2">üé≠</div>
                                                <h3 className="font-bold">Scenarios</h3>
                                            </button>
                                            <button onClick={() => setPage('philosophers')}
                                                    className="bg-white p-6 rounded-lg shadow hover:shadow-lg">
                                                <div className="text-4xl mb-2">üß†</div>
                                                <h3 className="font-bold">Philosophers</h3>
                                            </button>
                                            <button onClick={() => setPage('simulator')}
                                                    className="bg-white p-6 rounded-lg shadow hover:shadow-lg">
                                                <div className="text-4xl mb-2">‚öôÔ∏è</div>
                                                <h3 className="font-bold">Simulator</h3>
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {page === 'scenarios' && (
                                    <div>
                                        <h1 className="text-3xl font-bold mb-6">Historical Scenarios</h1>
                                        <div className="grid gap-6">
                                            {scenarios.map(s => (
                                                <div key={s.id} className="bg-white rounded-lg shadow-md p-6">
                                                    <h2 className="text-2xl font-bold mb-2">{s.title}</h2>
                                                    <p className="text-gray-600 mb-4">{s.description}</p>
                                                    <button onClick={() => { setScenario(s); setPage('simulator'); }}
                                                            className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
                                                        Run Scenario
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {page === 'simulator' && (
                                    <div>
                                        {!scenario ? (
                                            <div className="text-center py-12">
                                                <h2 className="text-2xl font-bold mb-4">No Scenario Selected</h2>
                                                <button onClick={() => setPage('scenarios')}
                                                        className="bg-blue-600 text-white px-6 py-3 rounded">
                                                    Browse Scenarios
                                                </button>
                                            </div>
                                        ) : (
                                            <div className="grid lg:grid-cols-3 gap-6">
                                                <div className="bg-white rounded-lg shadow-md p-6">
                                                    <h2 className="text-xl font-bold mb-4">Controls</h2>
                                                    <div className="space-y-4">
                                                        <div>
                                                            <label className="block font-bold mb-2">I: {I.toFixed(2)}</label>
                                                            <input type="range" min="0" max="1" step="0.05" value={I}
                                                                   onChange={(e) => setI(parseFloat(e.target.value))}
                                                                   className="w-full" />
                                                        </div>
                                                        <div>
                                                            <label className="block font-bold mb-2">Œµ: {epsilon.toFixed(2)}</label>
                                                            <input type="range" min="0" max="1" step="0.05" value={epsilon}
                                                                   onChange={(e) => setEpsilon(parseFloat(e.target.value))}
                                                                   className="w-full" />
                                                        </div>
                                                        <button onClick={runSim}
                                                                className="w-full bg-blue-600 text-white py-3 rounded hover:bg-blue-700">
                                                            Run Simulation
                                                        </button>
                                                    </div>
                                                </div>

                                                <div className="lg:col-span-2">
                                                    {!results ? (
                                                        <div className="bg-white rounded-lg shadow-md p-12 text-center">
                                                            <p>Adjust parameters and run simulation</p>
                                                        </div>
                                                    ) : (
                                                        <div className="space-y-6">
                                                            <div className="bg-white rounded-lg shadow-md p-6">
                                                                <h3 className="text-xl font-bold mb-4">Results</h3>
                                                                <div className="grid grid-cols-3 gap-4 mb-6">
                                                                    <div className="text-center p-4 bg-blue-50 rounded">
                                                                        <p className="text-3xl font-bold text-blue-600">
                                                                            {results.avgSuccess.toFixed(0)}%
                                                                        </p>
                                                                        <p className="text-sm">Success</p>
                                                                    </div>
                                                                    <div className="text-center p-4 bg-green-50 rounded">
                                                                        <p className="text-3xl font-bold text-green-600">
                                                                            {results.avgATCF.toFixed(0)}%
                                                                        </p>
                                                                        <p className="text-sm">ATCF</p>
                                                                    </div>
                                                                    <div className="text-center p-4 bg-purple-50 rounded">
                                                                        <p className="text-3xl font-bold text-purple-600">
                                                                            {results.robustness.toFixed(0)}%
                                                                        </p>
                                                                        <p className="text-sm">Robust</p>
                                                                    </div>
                                                                </div>
                                                                <ResponsiveContainer width="100%" height={300}>
                                                                    <LineChart data={results.timeSeriesData}>
                                                                        <CartesianGrid strokeDasharray="3 3" />
                                                                        <XAxis dataKey="time" />
                                                                        <YAxis />
                                                                        <Tooltip />
                                                                        <Legend />
                                                                        <Line type="monotone" dataKey="Success Rate (%)" stroke="#3b82f6" strokeWidth={2} />
                                                                        <Line type="monotone" dataKey="Avg ATCF" stroke="#10b981" strokeWidth={2} />
                                                                    </LineChart>
                                                                </ResponsiveContainer>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                )}

                                {page === 'philosophers' && (
                                    <div>
                                        <h1 className="text-3xl font-bold mb-6">Philosopher Database</h1>
                                        <div className="grid md:grid-cols-2 gap-6">
                                            {philosophers.map(p => (
                                                <div key={p.id} className="bg-white rounded-lg shadow-md overflow-hidden">
                                                    <div className="bg-gradient-to-r from-gray-700 to-gray-900 text-white p-6 text-center">
                                                        <div className="text-5xl mb-3">{p.image}</div>
                                                        <h2 className="text-xl font-bold">{p.name}</h2>
                                                        <p className="text-sm">{p.dates}</p>
                                                    </div>
                                                    <div className="p-6">
                                                        <div className="mb-4">
                                                            <span className="inline-block px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm font-bold">
                                                                {p.tradition}
                                                            </span>
                                                        </div>
                                                        <p className="italic mb-4">"{p.keyQuestion}"</p>
                                                        <div className="mb-4">
                                                            <p className="font-bold text-sm mb-2">Beliefs:</p>
                                                            <ul className="text-sm text-gray-600 space-y-1">
                                                                {p.beliefs.map((b, i) => <li key={i}>‚Ä¢ {b}</li>)}
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </main>
                        </div>
                    );
                }

                const root = ReactDOM.createRoot(document.getElementById('root'));
                root.render(<App />);
                
            } catch (error) {
                console.error('App error:', error);
                showError('Failed to load full app: ' + error.message);
            }
        }
    </script>
</body>
</html>
